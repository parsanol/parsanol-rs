<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 500">
  <defs>
    <linearGradient id="parserGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1d4ed8;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="transformGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#6d28d9;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="inputGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#64748b;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#475569;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="outputGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="4" stdDeviation="4" flood-opacity="0.2"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="900" height="500" fill="#f8fafc"/>

  <!-- Title -->
  <text x="450" y="40" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="24" font-weight="700" fill="#1e293b">The Two-Stage Parsing Model</text>

  <!-- Stage Labels -->
  <rect x="50" y="70" width="380" height="30" rx="4" fill="#dbeafe"/>
  <text x="240" y="91" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="600" fill="#1d4ed8">STAGE 1: PARSING</text>

  <rect x="470" y="70" width="380" height="30" rx="4" fill="#ede9fe"/>
  <text x="660" y="91" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="600" fill="#6d28d9">STAGE 2: TRANSFORMATION</text>

  <!-- Input Box -->
  <rect x="50" y="120" width="150" height="80" rx="12" fill="url(#inputGrad)" filter="url(#shadow)"/>
  <text x="125" y="155" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="14" font-weight="600" fill="white">INPUT</text>
  <text x="125" y="180" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="12" fill="#cbd5e1">"hello World!"</text>

  <!-- Arrow 1 -->
  <path d="M 210 160 L 270 160" stroke="#94a3b8" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#94a3b8"/>
    </marker>
  </defs>

  <!-- Parser Box -->
  <rect x="280" y="110" width="150" height="100" rx="12" fill="url(#parserGrad)" filter="url(#shadow)"/>
  <text x="355" y="145" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="16" font-weight="700" fill="white">Parser</text>
  <text x="355" y="168" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="11" fill="#bfdbfe">str(), re(), any()</text>
  <text x="355" y="185" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="11" fill="#bfdbfe">then(), or(), repeat()</text>

  <!-- Arrow 2 -->
  <path d="M 440 160 L 500 160" stroke="#94a3b8" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Parse Tree Box -->
  <rect x="510" y="120" width="150" height="80" rx="12" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" filter="url(#shadow)"/>
  <text x="585" y="150" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="600" fill="#92400e">Parse Tree</text>
  <text x="585" y="175" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="10" fill="#a16207">{greeting: "hello"}</text>

  <!-- Arrow 3 -->
  <path d="M 670 160 L 730 160" stroke="#94a3b8" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Transform Box -->
  <rect x="740" y="110" width="110" height="100" rx="12" fill="url(#transformGrad)" filter="url(#shadow)"/>
  <text x="795" y="145" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="700" fill="white">Transform</text>
  <text x="795" y="168" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#ddd6fe">simple(), seq()</text>
  <text x="795" y="185" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#ddd6fe">pattern rules</text>

  <!-- Output Box (below transform) -->
  <rect x="720" y="240" width="150" height="80" rx="12" fill="url(#outputGrad)" filter="url(#shadow)"/>
  <text x="795" y="275" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="600" fill="white">TYPED OUTPUT</text>
  <text x="795" y="300" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="10" fill="#a7f3d0">Greeting { name: "World" }</text>

  <!-- Arrow from Transform to Output -->
  <path d="M 795 220 L 795 234" stroke="#94a3b8" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>

  <!-- Parser Atoms Detail Box -->
  <rect x="50" y="280" width="200" height="180" rx="12" fill="white" stroke="#e2e8f0" stroke-width="2" filter="url(#shadow)"/>
  <text x="150" y="310" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="600" fill="#1e293b">Parser Atoms</text>
  <line x1="60" y1="325" x2="240" y2="325" stroke="#e2e8f0" stroke-width="1"/>
  <text x="70" y="350" font-family="JetBrains Mono, monospace" font-size="11" fill="#475569">str("hello")</text>
  <text x="180" y="350" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#64748b">literal</text>
  <text x="70" y="375" font-family="JetBrains Mono, monospace" font-size="11" fill="#475569">re("[0-9]+")</text>
  <text x="180" y="375" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#64748b">regex</text>
  <text x="70" y="400" font-family="JetBrains Mono, monospace" font-size="11" fill="#475569">any()</text>
  <text x="180" y="400" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#64748b">any char</text>
  <text x="70" y="425" font-family="JetBrains Mono, monospace" font-size="11" fill="#475569">.then()</text>
  <text x="180" y="425" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#64748b">sequence</text>
  <text x="70" y="450" font-family="JetBrains Mono, monospace" font-size="11" fill="#475569">.or()</text>
  <text x="180" y="450" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#64748b">alternative</text>

  <!-- Transform Patterns Detail Box -->
  <rect x="280" y="280" width="200" height="180" rx="12" fill="white" stroke="#e2e8f0" stroke-width="2" filter="url(#shadow)"/>
  <text x="380" y="310" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="14" font-weight="600" fill="#1e293b">Transform Patterns</text>
  <line x1="290" y1="325" x2="470" y2="325" stroke="#e2e8f0" stroke-width="1"/>
  <text x="300" y="350" font-family="JetBrains Mono, monospace" font-size="11" fill="#475569">simple(:x)</text>
  <text x="410" y="350" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#64748b">leaf</text>
  <text x="300" y="375" font-family="JetBrains Mono, monospace" font-size="11" fill="#475569">sequence(:x)</text>
  <text x="410" y="375" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#64748b">array</text>
  <text x="300" y="400" font-family="JetBrains Mono, monospace" font-size="11" fill="#475569">subtree(:x)</text>
  <text x="410" y="400" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#64748b">any tree</text>
  <text x="300" y="425" font-family="JetBrains Mono, monospace" font-size="11" fill="#475569">{key: pattern}</text>
  <text x="410" y="425" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#64748b">hash</text>

  <!-- Key Insight Box -->
  <rect x="510" y="280" width="170" height="100" rx="12" fill="#ecfdf5" stroke="#10b981" stroke-width="2" filter="url(#shadow)"/>
  <text x="595" y="310" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="600" fill="#047857">Why Two Stages?</text>
  <text x="595" y="335" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#065f46">Debug the tree</text>
  <text x="595" y="355" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#065f46">Transform multiple ways</text>
  <text x="595" y="375" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#065f46">Test independently</text>

  <!-- Dotted line connecting stages -->
  <path d="M 460 80 L 460 460" stroke="#94a3b8" stroke-width="1" stroke-dasharray="5,5"/>
</svg>