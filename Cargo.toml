[package]
name = "parsanol"
version = "0.1.0"
edition = "2021"
authors = ["Ribose Inc. <open.source@ribose.com>"]
license = "MIT"
description = "High-performance PEG parser library with packrat memoization and arena allocation"
repository = "https://github.com/parsanol/parsanol-rs"
readme = "README.adoc"
keywords = ["parser", "peg", "parsing", "grammar", "combinator", "packrat", "ast"]
categories = ["parsing", "text-processing", "development-tools"]
rust-version = "1.70"
exclude = ["/.github", "/benches", "/examples", "/tests", "/target", "*.md"]
documentation = "https://docs.rs/parsanol"
homepage = "https://github.com/parsanol/parsanol-rs"

[lib]
crate-type = ["cdylib", "rlib"]

[features]
default = []
ruby = ["magnus", "rb-sys"]
wasm = ["wasm-bindgen", "js-sys", "serde-wasm-bindgen", "console_error_panic_hook"]
logging = ["log"]

[dependencies]
# Core dependencies (always included)
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
regex = "1.10"
hashbrown = "0.16"
ahash = "0.8"
smallvec = { version = "1.13", features = ["const_new"] }
memchr = "2.7"
once_cell = "1.19"

# Logging (optional)
log = { version = "0.4", optional = true }

# Ruby FFI (optional)
magnus = { version = "0.8", optional = true }

# WASM bindings (optional)
wasm-bindgen = { version = "0.2", optional = true }
js-sys = { version = "0.3", optional = true }
serde-wasm-bindgen = { version = "0.6", optional = true }
console_error_panic_hook = { version = "0.1", optional = true }

# Proc macro for RubyObject derive (optional, for Native FFI mode)
parsanol-ruby-derive = { path = "crates/parsanol-ruby-derive", optional = true }

[dev-dependencies]
criterion = { version = "0.8", features = ["html_reports"] }
proptest = "1.4"

[build-dependencies]
rb-sys = { version = "0.9", optional = true }

[[bench]]
name = "comparison"
harness = false

[profile.release]
opt-level = 3
lto = true
codegen-units = 1

[profile.release.package."*"]
opt-level = "s"

[package.metadata.wasm-pack.profile.release]
wasm-opt = ["-Oz", "--enable-mutable-globals"]

[workspace]
resolver = "2"
members = [
    ".",
    "crates/parsanol-ruby-derive",
]

[workspace.package]
version = "0.1.0"
edition = "2021"
authors = ["Ribose Inc. <open.source@ribose.com>"]
license = "MIT"
repository = "https://github.com/parsanol/parsanol-rs"
